<!DOCTYPE html>
<html lang="en" data-bs-theme="dark" style="height: fit-content;">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="./styles/global.css">
  <style>
    i {
      animation-iteration-count: 1 !important;
      animation-delay: 500ms !important;
      -webkit-animation-iteration-count: 1 !important;
      -webkit-animation-delay: 500ms !important;
    }

    /* make sure header doesn't overlap content */
  </style>
  <script>
    window.onload = () => {
      fetch('nav.html')
        .then(response => response.text())
        .then(navhtml => document.querySelector('#nav').outerHTML = navhtml);
    }
  </script>
</head>


<body class="m-0">
  <header class="navbar navbar-expand-lg bg-main sticky-top">
    <nav id="nav" class="container">
      <!-- nav.html will be inserted here -->
    </nav>

  </header>

  <div class="container mx-auto mt-3" style="max-width: 600px;">
    <!-- heading -->
    <h1 class="text-center text-dim fw-medium my-4">Standings</h1>
    <hr class="text-dim my-4" style="height: 3px;">
    <div class="table-responsive">
      <table id="mytable" class="table table-sm table-borderless align-middle m-0">
        <tbody>
          <tr>
            <td class="pt-0 pb-1 align-middle text-center text-dim opacity-50 text-smaller fw-medium px-0"></td>
            <td class="pt-0 pb-1 align-middle text-center text-dim opacity-50 text-smaller fw-medium px-0"></td>
            <td class="pt-0 pb-1 align-middle text-center text-dim opacity-50 text-smaller fw-medium px-0">WK</td>
            <td class="pt-0 pb-1 align-middle text-center text-dim opacity-50 text-smaller fw-medium px-0">TTL</td>
            <td class="pt-0 pb-1 align-middle text-center text-dim opacity-50 text-smaller fw-medium px-0">GB</td>
            <td class="pt-0 pb-1 align-middle text-center text-dim opacity-50 text-smaller fw-medium px-0">DOG</td>
            <td class="pt-0 pb-1 align-middle text-center text-dim opacity-50 text-smaller fw-medium px-0">DOG W</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <template id="row-template">
    <tr>
      <td data-item="rank" class="pt-2 text-nowrap align-middle text-nowrap ps-0 text-end text-primary-emphasis text-smaller fw-medium"></td>
      <td data-item="player-cont" class="pt-2 ps-2 text-nowrap align-middle text-nowrap fw-medium pe-3">
        <div class="d-flex flex-row align-items-center p-0 bg-main">
          <span data-item="player" class="pe-2"></span>
          <i data-item="change-icon" class="d-none"></i>
          <span data-item="change" class="d-none text-smaller ps-1"></span>
      </td>
      <td data-item="rec_week" class="pt-2 text-nowrap align-middle text-nowrap text-center"></td>
      <td data-item="rec" class="pt-2 text-nowrap align-middle text-nowrap text-center"></td>
      <td data-item="gb" class="pt-2 text-nowrap align-middle text-nowrap text-center text-dim"></td>
      <td data-item="pc_dog_pick" class="pt-2 text-nowrap align-middle text-nowrap text-center text-dim"></td>
      <td data-item="pc_dog_win" class="pt-2 text-nowrap align-middle text-nowrap text-center text-dim"></td>
    </tr>
  </template>
  <script src="./scripts/getSheet.js"></script>
  <script>

    let dataSTANDINGS = null;

    sendData();

    /* ------------------------------------------------ */

    async function sendData() {
      const data = await getSheet('Standings');
      dataSTANDINGS = data;

      appendData();
    }

    /* ------------------------------------------------ */

    function appendData() {
      let data = dataSTANDINGS;
      let tbl = document.getElementById('mytable');
      let template = document.getElementById('row-template');

      data.forEach((g) => {
        let clone = template.content.cloneNode(true);
        let row = clone.querySelector('tr');
        row.querySelector('[data-item="rank"]').textContent = g.rank;
        let pcont = row.querySelector('[data-item="player-cont"]');
        let player = pcont.querySelector('[data-item="player"]');
        let changeIcon = pcont.querySelector('[data-item="change-icon"]');
        let change = pcont.querySelector('[data-item="change"]');
        player.textContent = g.player;

        if (parseInt(g.change) > 0) {
          changeIcon.classList.remove('d-none');
          changeIcon.classList.add('fa-regular', 'fa-circle-up', 'fa-sm', 'text-success-emphasis', 'fa-bounce');
          change.classList.remove('d-none');
          change.classList.add('text-success-emphasis');
          change.textContent = g.change.replace('-', '');
        } else if (parseInt(g.change) < 0) {
          changeIcon.classList.remove('d-none');
          changeIcon.classList.add('fa-regular', 'fa-circle-down', 'fa-sm', 'text-danger-emphasis', 'fa-bounce');
          change.classList.remove('d-none');
          change.classList.add('text-danger-emphasis');
          change.textContent = g.change.replace('-', '');
        }

        row.querySelector('[data-item="rec_week"]').textContent = g.rec_week;
        row.querySelector('[data-item="rec"]').textContent = g.rec;
        row.querySelector('[data-item="gb"]').textContent = (g.gb == '') ? '-' : g.gb;
        row.querySelector('[data-item="pc_dog_pick"]').textContent = g.pc_dog_pick;
        row.querySelector('[data-item="pc_dog_win"]').textContent = g.pc_dog_win;

        tbl.appendChild(clone);
      });

    }

  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous">
  </script>
</body>

</html>